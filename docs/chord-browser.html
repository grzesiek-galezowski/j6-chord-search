<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J-6 Chord Browser (Web)</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #0f172a;
      --panel: #111827;
      --accent: #38bdf8;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --border: #1f2937;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, Segoe UI, sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    header {
      padding: 24px;
      background: linear-gradient(135deg, #0b1222, #0f172a 45%, #0b1326);
      border-bottom: 1px solid var(--border);
    }

    header h1 {
      margin: 0 0 8px 0;
      font-size: 24px;
      letter-spacing: 0.5px;
    }

    header p {
      margin: 0;
      color: var(--muted);
    }

    .container {
      padding: 20px 24px 48px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 16px;
    }

    input[type="text"] {
      flex: 1;
      min-width: 240px;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      font-size: 15px;
    }

    button {
      padding: 11px 14px;
      border-radius: 10px;
      border: 1px solid var(--accent);
      background: var(--accent);
      color: #0b1222;
      font-weight: 600;
      cursor: pointer;
      transition: transform 120ms ease, filter 120ms ease;
    }

    button:hover { filter: brightness(1.05); }
    button:active { transform: translateY(1px); }

    .hint {
      width: 100%;
      color: var(--muted);
      font-size: 13px;
    }

    h2 {
      margin: 28px 0 12px;
      font-size: 18px;
      letter-spacing: 0.3px;
    }

    .grid {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .badge {
      background: rgba(56, 189, 248, 0.1);
      color: var(--accent);
      border: 1px solid rgba(56, 189, 248, 0.4);
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 12px;
    }

    .transposer {
      width: 100%;
      accent-color: var(--accent);
    }

    .keyboard {
      display: flex;
      position: relative;
      height: 90px;
      margin-top: 6px;
    }

    .white-keys {
      display: flex;
      width: 100%;
    }

    .white-key {
      flex: 1;
      background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
      border: 1px solid #94a3b8;
      border-radius: 0 0 6px 6px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 6px;
      font-size: 11px;
      font-weight: 600;
      color: #1e293b;
      min-width: 0;
      position: relative;
      box-shadow: 0 4px 6px rgba(0,0,0,0.15);
    }

    .white-key:hover {
      background: linear-gradient(180deg, #ffffff 0%, #f1f5f9 100%);
    }

    .white-key { cursor: pointer; }

    .white-key.active {
      background: linear-gradient(180deg, #38bdf8 0%, #0ea5e9 100%) !important;
      color: #fff;
    }

    .black-keys {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 55px;
      display: flex;
      pointer-events: none;
    }

    .black-key-slot {
      flex: 1;
      display: flex;
      justify-content: center;
      position: relative;
    }

    .black-key {
      position: absolute;
      width: 70%;
      max-width: 48px;
      height: 100%;
      background: linear-gradient(180deg, #334155 0%, #1e293b 100%);
      border: 1px solid #0f172a;
      border-radius: 0 0 4px 4px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 4px;
      font-size: 9px;
      font-weight: 600;
      color: #e2e8f0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
      pointer-events: auto;
      z-index: 1;
    }

    .black-key:hover {
      background: linear-gradient(180deg, #475569 0%, #334155 100%);
    }

    .black-key { cursor: pointer; }

    .black-key.active {
      background: linear-gradient(180deg, #0ea5e9 0%, #0284c7 100%) !important;
      color: #fff;
    }

    /* Position black keys between white keys (at right edge of each slot) */
    .black-key-slot:nth-child(1) .black-key { left: 100%; transform: translateX(-50%); } /* C# between C and D */
    .black-key-slot:nth-child(2) .black-key { left: 100%; transform: translateX(-50%); } /* D# between D and E */
    .black-key-slot:nth-child(3) .black-key { display: none; } /* No black key between E and F */
    .black-key-slot:nth-child(4) .black-key { left: 100%; transform: translateX(-50%); } /* F# between F and G */
    .black-key-slot:nth-child(5) .black-key { left: 100%; transform: translateX(-50%); } /* G# between G and A */
    .black-key-slot:nth-child(6) .black-key { left: 100%; transform: translateX(-50%); } /* A# between A and B */
    .black-key-slot:nth-child(7) .black-key { display: none; } /* No key after B */

    .chord-label {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
      padding: 0 2px;
    }

    .empty {
      color: var(--muted);
      font-style: italic;
      padding: 12px 0;
    }

    .summary {
      color: var(--muted);
      font-size: 13px;
      margin: 4px 0 16px;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 8px;
      font-size: 13px;
      color: var(--accent);
      text-decoration: none;
    }

    .back-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <a href="./index.html" class="back-link">← Back to Tools</a>
    <h1>Roland J-6 Chord Sequence Search and Browser</h1>
    <p>Client-side search and browse of all chord sets. No server required.</p>
  </header>

  <div class="container">
    <section class="controls">
      <input id="search" type="text" placeholder="Search chords (use * or ? wildcards, space/comma separated)" autocomplete="off" />
      <button id="clear">Clear</button>
      <div class="hint">Checks every progression across 12 semitone transpositions. Example: <code>G*</code> <code>*m7</code> <code>D?/F#</code></div>
    </section>

    <section>
      <div class="card" style="padding:12px 14px 10px;">
        <div class="card-header" style="margin-bottom:6px;">
          <h2 style="margin:0; font-size:16px;">Search results</h2>
          <span class="summary" id="resultSummary"></span>
        </div>
        <div id="results" class="grid"></div>
      </div>
    </section>

    <section>
      <h2>Browse all progressions</h2>
      <p class="summary">Adjust transposition per row to audition in different keys.</p>
      <div id="browser" class="grid"></div>
    </section>
  </div>

  <!-- Raw chord data taken from InitializeChordSets in MainWindow.xaml.cs -->
  <script type="application/csharp" id="chord-data">
return
[
      new()
      {
        Number = 1,
        Name = "Pop",
        Chords =
        [
          "Cadd9",
          "C#M9/C",
          "Dm7",
          "D#M7",
          "Cadd9/E",
          "FM9",
          "Dadd9/F#",
          "Em7/G",
          "Fm6/G#",
          "FM/A",
          "Gm/A#",
          "G/B"
        ]
      },

      new()
      {
        Number = 2,
        Name = "Pop",
        Chords =
        [
          "CM9",
          "C#dim7",
          "Dm9",
          "D#dim7",
          "Em7",
          "FM9",
          "F#m7b5",
          "F/A",
          "G#dim7",
          "Am9",
          "C/A#",
          "Bm7b5"
        ]
      },

      new()
      {
        Number = 3,
        Name = "Jazz",
        Chords =
        [
          "D7sus2/C",
          "C#7#9",
          "Dm9",
          "D7#9",
          "E7#9",
          "FM9",
          "F#7#9",
          "G7(13)",
          "G#7(13)",
          "Am7(11)",
          "A#9",
          "Bm7(11)"
        ]
      },

      new()
      {
        Number = 4,
        Name = "Jazz",
        Chords =
        [
          "Dsus2/C",
          "C#7#9",
          "Dm9",
          "D#9",
          "Em9",
          "Fm9",
          "F#m7b5",
          "Gaug7",
          "G#7(13)",
          "Aaug7",
          "A#7(13)",
          "Bm7(11)"
        ]
      },

      new()
      {
        Number = 5,
        Name = "Jazz",
        Chords =
        [
          "CM9",
          "C#M7",
          "DM9",
          "D#M9",
          "EM9",
          "FM9",
          "F#M9",
          "GM9",
          "G#M9",
          "AM9",
          "A#M9",
          "BM9"
        ]
      },

      new()
      {
        Number = 6,
        Name = "Blues",
        Chords =
        [
          "C9",
          "C#9",
          "D9",
          "D#9",
          "E7#9",
          "Fm9",
          "F#dim7",
          "G7(13)",
          "G#dim7",
          "Aaug7",
          "A#7(13)",
          "Bm7b5"
        ]
      },

      new()
      {
        Number = 7,
        Name = "Trad Maj",
        Chords =
        [
          "C",
          "C#dim7",
          "Dm",
          "D#dim7",
          "Em",
          "F",
          "F#m7b5",
          "G",
          "G#dim7",
          "Am",
          "A#",
          "Bdim"
        ]
      },

      new()
      {
        Number = 7,
        Name = "Trad Maj",
        Chords =
        [
          "C",
          "C#dim7",
          "Dm",
          "D#dim7",
          "Em",
          "F",
          "F#m7b5",
          "G",
          "G#dim7",
          "Am",
          "A#",
          "Bdim"
        ]
      },

      new()
      {
        Number = 8,
        Name = "Trad Min",
        Chords =
        [
          "Cm",
          "C#",
          "Ddim",
          "Eb",
          "Edim7",
          "Fm",
          "F#dim7",
          "Gm",
          "G#",
          "Am7b5",
          "A#",
          "Bdim7"
        ]
      },

      new()
      {
        Number = 9,
        Name = "Trad Min 2",
        Chords =
        [
          "Cm",
          "C#",
          "Ddim",
          "D#aug",
          "Em",
          "Fm",
          "F#dim7",
          "G",
          "G#",
          "Am7b5",
          "A#",
          "Bdim"
        ]
      },

      new()
      {
        Number = 10,
        Name = "Pop Min",
        Chords =
        [
          "Cmadd9",
          "C#M7",
          "Dm7b5",
          "D#M7",
          "Edim7",
          "Fm9",
          "F#dim7",
          "Gm7",
          "G#M7",
          "Am7b5",
          "G#/A#",
          "Bdim7"
        ]
      },

      new()
      {
        Number = 11,
        Name = "Pop Min",
        Chords =
        [
          "Cmadd9",
          "Gdim/C#",
          "Dm7b5",
          "D#M7",
          "EM9",
          "Fm9",
          "F#dim7",
          "Gaug7",
          "G#M7",
          "Am7b5",
          "Cm7/A#",
          "Baug#9"
        ]
      },

      new()
      {
        Number = 12,
        Name = "Jazz Min",
        Chords =
        [
          "Cm7(11)",
          "C#7#9",
          "Dm7b5",
          "D#M7#5",
          "E9",
          "F9",
          "F#dim7",
          "G7#9",
          "G#M7b5",
          "Am7b5",
          "A#m7",
          "Bdim7"
        ]
      },

      new()
      {
        Number = 13,
        Name = "Jazz Min",
        Chords =
        [
          "Cm9",
          "C#9",
          "Dm9",
          "D#9",
          "EM9",
          "Fm9",
          "F#dim7",
          "G7(13)",
          "G#m6",
          "Am7b5",
          "A#m7",
          "Bm7b5"
        ]
      },

      new()
      {
        Number = 17,
        Name = "Utility",
        Chords =
        [
          "C",
          "C#",
          "D",
          "D#",
          "E",
          "F",
          "F#",
          "G",
          "G#",
          "A",
          "A#",
          "B"
        ]
      },

      new()
      {
        Number = 18,
        Name = "Utility",
        Chords =
        [
          "Cm",
          "C#m",
          "Dm",
          "D#m",
          "E",
          "Fm",
          "F#m",
          "Gm",
          "G#m",
          "Am",
          "A#m",
          "Bm"
        ]
      },

      new()
      {
        Number = 19,
        Name = "Utility",
        Chords =
        [
          "CM7",
          "C#M7",
          "DM7",
          "D#M7",
          "EM7",
          "FM7",
          "F#M7",
          "GM7",
          "G#M7",
          "AM7",
          "A#M7",
          "BM7"
        ]
      },

      new()
      {
        Number = 20,
        Name = "Utility",
        Chords =
        [
          "Cm7",
          "C#m7",
          "Dm7",
          "D#m7",
          "Em7",
          "Fm7",
          "F#m7",
          "Gm7",
          "G#m7",
          "Am7",
          "A#m7",
          "Bm7"
        ]
      },

      new()
      {
        Number = 21,
        Name = "Utility",
        Chords =
        [
          "CM9",
          "C#M9",
          "DM9",
          "D#M9",
          "EM9",
          "FM9",
          "F#M9",
          "GM9",
          "G#M9",
          "AM9",
          "A#M9",
          "BM9"
        ]
      },

      new()
      {
        Number = 22,
        Name = "Utility",
        Chords =
        [
          "Cm9",
          "C#m9",
          "Dm9",
          "D#m9",
          "Em9",
          "Fm9",
          "F#m9",
          "Gm9",
          "G#m9",
          "Am9",
          "A#m9",
          "Bm9"
        ]
      },

      new()
      {
        Number = 23,
        Name = "Utility",
        Chords =
        [
          "CM9#11",
          "C#M9#11",
          "DM9#11",
          "D#M9#11",
          "EM9#11",
          "FM9#11",
          "F#M9#11",
          "GM9#11",
          "G#M9#11",
          "AM9#11",
          "A#M9#11",
          "BM9#11"
        ]
      },

      new()
      {
        Number = 24,
        Name = "Utility",
        Chords =
        [
          "Cm9/11",
          "C#m9/11",
          "Dm9/11",
          "D#m9/11",
          "Em9/11",
          "Fm9/11",
          "F#m9/11",
          "Gm9/11",
          "G#m9/11",
          "Am9/11",
          "A#m9/11",
          "Bm9/11"
        ]
      },

      new()
      {
        Number = 26,
        Name = "Utility",
        Chords =
        [
          "Cm7",
          "Cm7/D#",
          "Cm7/G",
          "Cm7/A#",
          "Cm7",
          "Cm7/D#",
          "Cm7",
          "Cm7/G",
          "Cm7",
          "Cm7/D#",
          "Cm7/G",
          "Cm7/A#"
        ]
      },

      new()
      {
        Number = 27,
        Name = "Pop/Synth",
        Chords =
        [
          "C",
          "Em",
          "G",
          "Am",
          "Bm",
          "C",
          "Em",
          "G",
          "Am",
          "Bm",
          "C",
          "Em"
        ]
      },

      new()
      {
        Number = 28,
        Name = "Pop",
        Chords =
        [
          "C",
          "C7",
          "Dm7",
          "D#M7",
          "C/E",
          "F",
          "Fm",
          "G",
          "C/G",
          "Am7",
          "Eaug/A#",
          "G7/B"
        ]
      },


      new()
      {
        Number = 28,
        Name = "Pop",
        Chords =
        [
          "C",
          "C7",
          "Dm7",
          "D#M7",
          "C/E",
          "F",
          "Fm",
          "G",
          "C/G",
          "Am7",
          "Eaug/A#",
          "G7/B"
        ]
      },

      new()
      {
        Number = 29,
        Name = "Pop",
        Chords =
        [
          "C",
          "FM7",
          "G",
          "Em7",
          "Dm7",
          "CM7/E",
          "F",
          "D7/G",
          "G",
          "Am",
          "Dm",
          "G7"
        ]
      },

      new()
      {
        Number = 30,
        Name = "Pop",
        Chords =
        [
          "Cm",
          "D#",
          "G#",
          "A#",
          "Gm",
          "G#",
          "D#",
          "A#sus4/D",
          "Cm",
          "G/B",
          "G#",
          "F/A"
        ]
      },

      new()
      {
        Number = 31,
        Name = "Pop",
        Chords =
        [
          "Cadd11",
          "Bb/C",
          "Dm7",
          "D7",
          "Cadd9/E",
          "FM7",
          "F7",
          "Gm7",
          "A/G",
          "FM7/A",
          "F/Bb",
          "G7/B"
        ]
      },

      new()
      {
        Number = 32,
        Name = "Pop",
        Chords =
        [
          "Cmb13",
          "D#M7",
          "G7/D",
          "A#/D#",
          "C7",
          "Fm7",
          "D#",
          "Gm7",
          "G#M9",
          "G#m6",
          "F7/A",
          "A#add11"
        ]
      },

      new()
      {
        Number = 33,
        Name = "Cinematic",
        Chords =
        [
          "CM7",
          "F/E",
          "A#M7",
          "G",
          "Dm7",
          "C",
          "A#M7",
          "G",
          "C",
          "A/C#",
          "Dm",
          "G/F"
        ]
      },

      new()
      {
        Number = 34,
        Name = "Cinematic/Synthwave",
        Chords =
        [
          "Csus2",
          "Dsus2",
          "D#sus2",
          "Fsus2",
          "Gsus2",
          "A#sus2",
          "Csus2",
          "Dsus2",
          "D#sus2",
          "Fsus2",
          "Gsus2",
          "A#sus2"
        ]
      },

      new()
      {
        Number = 35,
        Name = "Cinematic/House",
        Chords =
        [
          "CM7",
          "Am7",
          "DM7",
          "Bm7",
          "EM7",
          "C#m7",
          "F#M7",
          "D#m7",
          "G#M7",
          "Fm7",
          "A#M7",
          "Gm7"
        ]
      },

      new()
      {
        Number = 36,
        Name = "Cinematic",
        Chords =
        [
          "Ebsus2/C",
          "Fsus2/D",
          "Gsus2/E",
          "Absus2/F",
          "Bbsus2/G",
          "Csus2/A",
          "Dsus2/B",
          "Ebsus2/C",
          "Fsus2/D",
          "Gsus2/E",
          "Absus2/F",
          "Bbsus2/G"
        ]
      },

      new()
      {
        Number = 37,
        Name = "Cinematic",
        Chords = new List<string>
        {
          "C6sus2",
          "Dsus2",
          "Emadd11",
          "Dadd9/F#",
          "Gadd9",
          "Am7/11",
          "Bm7",
          "C6",
          "D6",
          "Emadd9",
          "E7sus4",
          "Em7b5/F"
        }
      },
      new()
      {
        Number = 38,
        Name = "New Age/Cinematic",
        Chords = new List<string>
        {
          "C",
          "Gsus4",
          "G7sus4",
          "A#/D#",
          "C/E",
          "Gsus4/F",
          "D/F#",
          "C/G",
          "E/G#",
          "Am",
          "Fsus4",
          "G"
        }
      },
      new()
      {
        Number = 39,
        Name = "Synthwave",
        Chords = new List<string>
        {
          "C6sus4",
          "Gmadd9/D",
          "Edim11",
          "Fsus2/D",
          "BbM7",
          "Gmadd9",
          "Am/G",
          "C7/G",
          "A#M7",
          "Gm/A",
          "C7/A#",
          "A#m6"
        }
      },
      new()
      {
        Number = 40,
        Name = "Synthwave",
        Chords = new List<string>
        {
          "Cadd9",
          "Dadd9",
          "D#add9",
          "Fadd9",
          "Gadd9",
          "G#add9",
          "A#add9",
          "Cadd9",
          "Dadd9",
          "D#add9",
          "Fadd9",
          "Gadd9"
        }
      },
      new()
      {
        Number = 41,
        Name = "Synthwave",
        Chords = new List<string>
        {
          "C",
          "C#dim7",
          "Fsus2/D",
          "D#add9",
          "Csus2/E",
          "FM7",
          "F#dim",
          "Gsus4",
          "G#6",
          "Csus2/A",
          "Csus2/A#",
          "G7/B"
        }
      },
      new()
      {
        Number = 42,
        Name = "Synthwave",
        Chords = new List<string>
        {
          "C",
          "A#sus2/D#",
          "A#7/G#",
          "G/B",
          "C",
          "Fm",
          "F#dim7",
          "C",
          "G#add9",
          "F/A",
          "A#",
          "G7/B"
        }
      },
      new()
      {
        Number = 43,
        Name = "Synthwave",
        Chords = new List<string>
        {
          "Cm7",
          "A#/C",
          "D#/G#",
          "A#/G#",
          "D#/F",
          "A#/F",
          "G#add9",
          "A#",
          "G#M7",
          "Fsus2/A",
          "A#6",
          "Fm7/B"
        }
      },
      new()
      {
        Number = 44,
        Name = "Synthwave",
        Chords = new List<string>
        {
          "Cm7",
          "C#sus2/F",
          "Gm7",
          "D#",
          "Csus2/E",
          "Fm",
          "D#dim7",
          "G#sus2/G",
          "Cm7",
          "F7",
          "Fm7",
          "G5"
        }
      },
      new()
      {
        Number = 45,
        Name = "Synthwave",
        Chords = new List<string>
        {
          "Ab",
          "Fm",
          "Gm",
          "Ab",
          "Fm",
          "Bb",
          "Gm",
          "Cm",
          "Ab",
          "Fm",
          "Bb",
          "Cm"
        }
      },
      new()
      {
        Number = 46,
        Name = "Synthwave",
        Chords = new List<string>
        {
          "C",
          "D",
          "Em",
          "D",
          "G",
          "Am",
          "Bm",
          "C",
          "D",
          "Em",
          "D",
          "G"
        }
      },
      new()
      {
        Number = 47,
        Name = "Synthwave/House",
        Chords = new List<string>
        {
          "Cm7",
          "D#M7",
          "Dm7",
          "Fm7",
          "D#M7",
          "Gm7",
          "Fm7",
          "G#M7",
          "Gm7",
          "A#7",
          "G#M7",
          "C#/C"
        }
      },
      new()
      {
        Number = 48,
        Name = "Trance",
        Chords = new List<string>
        {
          "Cm",
          "Ab/C",
          "Bb/D",
          "Eb",
          "C/E",
          "Fm",
          "F",
          "Gm",
          "Ab",
          "F7/A",
          "Bb",
          "G7/B"
        }
      },
      new()
      {
        Number = 49,
        Name = "House",
        Chords = new List<string>
        {
          "Cm7",
          "C#m7",
          "Dm7",
          "EbM7",
          "Gm/E",
          "Eb/F",
          "D7/F#",
          "Gm7",
          "AbM7",
          "Ab/Bb",
          "BbM7",
          "Bm7b5"
        }
      },
      new()
      {
        Number = 50,
        Name = "House",
        Chords = new List<string>
        {
          "Cmaj7",
          "Dmaj7",
          "Em7",
          "Fmaj9",
          "Gmaj9",
          "Eadd9/G#",
          "Am7",
          "Bm7",
          "Cmaj9",
          "Dm7/9",
          "Em7",
          "Fmaj7"
        }
      },
      new()
      {
        Number = 51,
        Name = "House",
        Chords = new List<string>
        {
          "Cm7",
          "G#/C#",
          "Dm7",
          "A#/D#",
          "Em7",
          "C/F",
          "F#m7",
          "D/G",
          "G#m7",
          "E/A",
          "A#m7",
          "F#/B"
        }
      },
      new()
      {
        Number = 52,
        Name = "House",
        Chords = new List<string>
        {
          "Cm7",
          "G#M7",
          "Dm7",
          "A#M7",
          "Em7",
          "CM7",
          "F#m7",
          "DM7",
          "G#m7",
          "EM7",
          "A#m7",
          "F#M7"
        }
      },
      new()
      {
        Number = 53,
        Name = "House",
        Chords = new List<string>
        {
          "Cm7/11",
          "Cdim7",
          "C#M7b5",
          "Ddim7",
          "Cm",
          "C#M7",
          "CM7",
          "Em7",
          "FM7",
          "Fm6",
          "Csus2/E",
          "Fm"
        }
      },
      new()
      {
        Number = 54,
        Name = "House",
        Chords = new List<string>
        {
          "CM7",
          "Em7",
          "Dm7",
          "FM7",
          "D#M7",
          "Gm7",
          "FM7",
          "Am7",
          "Gm7",
          "A#M7",
          "Am7",
          "Bm7"
        }
      },
      new()
      {
        Number = 55,
        Name = "Jazz House",
        Chords = new List<string>
        {
          "CM13",
          "CM7#5",
          "Dm7b5",
          "G7",
          "Cadd9/E",
          "Fadd9",
          "FmAdd9",
          "G9",
          "E7/G#",
          "Am9/11",
          "Gm11/Bb",
          "CM7#5/G#"
        }
      },
      new()
      {
        Number = 56,
        Name = "Jazz House",
        Chords = new List<string>
        {
          "Cm7",
          "Db6",
          "Dm7",
          "Dm7b5",
          "EbM7",
          "Fm7",
          "Gb6",
          "Gm7",
          "Ab6",
          "AbM7",
          "Am7",
          "BbM7"
        }
      },
      new()
      {
        Number = 57,
        Name = "House/Techno",
        Chords = new List<string>
        {
          "C5b9",
          "DbM7",
          "Dm7",
          "Ebsus11",
          "EM7#11",
          "Fm9",
          "GbM7#11",
          "Gm7",
          "AbM7#11",
          "A7alt",
          "Bb5add9b13",
          "C7sus4"
        }
      },
      new()
      {
        Number = 58,
        Name = "Techno",
        Chords = new List<string>
        {
          "Cm7",
          "A#m/C#",
          "A#/D",
          "D#",
          "C/E",
          "Cm/F",
          "D/F#",
          "G",
          "G#M7",
          "Csus4/A",
          "D#/A#",
          "G/B"
        }
      },
      new()
      {
        Number = 59,
        Name = "EDM",
        Chords = new List<string>
        {
          "CM9",
          "C6",
          "Dm9",
          "Dm6",
          "EM9",
          "FM9",
          "F6",
          "GM9",
          "G6",
          "Am9",
          "Am6",
          "Bm9"
        }
      },
      new()
      {
        Number = 60,
        Name = "EDM",
        Chords = new List<string>
        {
          "CM13(no 3)",
          "EM9(no 3)",
          "DM13(no 3)",
          "F#M9(no 3)",
          "EM13(no 3)",
          "FM13(no 3)",
          "AM9(no 3)",
          "GM13(no 3)",
          "BM9(no 3)",
          "AM13(no 3)",
          "C#M9(no 3)",
          "BM13(no 3)"
        }
      },
      new()
      {
        Number = 61,
        Name = "EDM",
        Chords = new List<string>
        {
          "Csus9/13",
          "C6",
          "Dsus9/13",
          "D6",
          "Esus9/13",
          "Fsus9/13",
          "F6",
          "Gsus9/13",
          "G6",
          "Asus9/13",
          "A6",
          "Bsus9/13"
        }
      },
      new()
      {
        Number = 62,
        Name = "EDM",
        Chords = new List<string>
        {
          "CM13",
          "C#sus9",
          "DM13",
          "D#sus9",
          "EM13",
          "FM13",
          "F#sus9",
          "Gmaj13",
          "Absus9",
          "AM13",
          "Bbsus9",
          "BM13"
        }
      },
      new()
      {
        Number = 63,
        Name = "EDM",
        Chords = new List<string>
        {
          "CM7",
          "Dbm7",
          "Dm7",
          "Eb6",
          "Em7",
          "FM7",
          "Gbm7",
          "GM7",
          "Abm7",
          "Am7",
          "Bb6",
          "Bm7"
        }
      },
      new()
      {
        Number = 64,
        Name = "EDM",
        Chords = new List<string>
        {
          "C6",
          "AM7",
          "D6",
          "BM7",
          "E6",
          "F6",
          "DM7",
          "G6",
          "EM7",
          "A6",
          "GbM7",
          "B6"
        }
      },
      new()
      {
        Number = 65,
        Name = "Gospel/R&B",
        Chords = new List<string>
        {
          "G/C",
          "C#dim7",
          "Dm7b5",
          "D#dim7",
          "Em7",
          "Fm11",
          "F#dim7",
          "Gm7b13",
          "G#M9",
          "Am7b13",
          "A#m7add13",
          "Bm7b13"
        }
      },
      new()
      {
        Number = 66,
        Name = "Gospel/R&B",
        Chords = new List<string>
        {
          "Cm7b13",
          "C#M13",
          "Dm7b13",
          "D#m11",
          "D/E",
          "G#m/F",
          "F#6",
          "A#m/G",
          "G#m11",
          "AM9",
          "A#7b13",
          "F#/B"
        }
      },
      new()
      {
        Number = 67,
        Name = "Gospel/R&B",
        Chords = new List<string>
        {
          "D",
          "C/D",
          "D/E",
          "Dm/F",
          "Dsus2/F#",
          "Gadd9",
          "E/G#",
          "A",
          "A#dim7",
          "Bm7",
          "D/C",
          "C#dim"
        }
      },
      new()
      {
        Number = 68,
        Name = "Lofi R&B",
        Chords = new List<string>
        {
          "Cmadd9",
          "Abadd9/C",
          "Bb7/D",
          "EbM9",
          "Eb7b9",
          "Fm9",
          "GbM6/9",
          "Gm7",
          "Eb/Ab",
          "Fsus4/A",
          "Bbsus",
          "Bbsus4b9"
        }
      },
      new()
      {
        Number = 69,
        Name = "Lofi R&B",
        Chords = new List<string>
        {
          "Ab7/C",
          "C#m11",
          "DM9",
          "Bsus4/Eb",
          "EMadd2",
          "DM7#11",
          "F#m11",
          "G6",
          "Abm7",
          "AM7add6",
          "F#add9/A#",
          "BMadd4"
        }
      },
      new()
      {
        Number = 70,
        Name = "Funk",
        Chords = new List<string>
        {
          "C9",
          "C/D",
          "D7b9",
          "EbM7",
          "Em7b13",
          "Eb/F",
          "F#13",
          "G7",
          "Abm6addb13",
          "Am7",
          "Bm7",
          "B7"
        }
      },
      new()
      {
        Number = 71,
        Name = "Funk",
        Chords = new List<string>
        {
          "C7alt",
          "DbM7",
          "D7alt",
          "Eb7",
          "C7/E",
          "F7alt",
          "F11sus2",
          "Gm7b5",
          "Ab9",
          "Bb9sus",
          "Bb7add9",
          "C11sus2"
        }
      },
      new()
      {
        Number = 72,
        Name = "Neo Soul",
        Chords = new List<string>
        {
          "Cm9",
          "AbM7",
          "Dm7",
          "EbDimM7",
          "EbM7",
          "Fm7",
          "CM7#5",
          "Gm7",
          "G7#5",
          "AbM7",
          "Fm7b5/B",
          "Bb13/D"
        }
      },
      new()
      {
        Number = 73,
        Name = "Neo Soul",
        Chords = new List<string>
        {
          "Cm7",
          "C#dim7",
          "Fm7",
          "Fm7b5",
          "EbM7",
          "Cm7/Eb",
          "Edim",
          "AbM7",
          "Fm7",
          "AbM13",
          "Bb13",
          "Bb6"
        }
      },
      new()
      {
        Number = 74,
        Name = "Neo Soul",
        Chords = new List<string>
        {
          "Em7/D",
          "Gm7b5/C#",
          "FM7/E",
          "DMb7/D#",
          "GM7/F#",
          "Edim7",
          "Cadd13/E",
          "E",
          "Gaddb9/G#",
          "Am9",
          "Dm7",
          "Emb9/F"
        }
      },
      new()
      {
        Number = 75,
        Name = "Neo Soul",
        Chords = new List<string>
        {
          "CM7",
          "C#m7",
          "Dm7",
          "EbM7",
          "Em7",
          "FM7",
          "Gb7",
          "GM7",
          "AbM7",
          "Am7",
          "BbM7",
          "Bm7"
        }
      },
      new()
      {
        Number = 76,
        Name = "Neo-Soul",
        Chords = new List<string>
        {
          "CM7sus2",
          "Gadd9/B",
          "DM7sus2",
          "E6sus4/C#",
          "EM7sus2",
          "F#6sus4/D#",
          "F#M7sus2",
          "G#6sus4/F",
          "G#M7sus2",
          "A#6sus4/G",
          "A#M7sus2",
          "Fadd9/A"
        }
      },
      new()
      {
        Number = 77,
        Name = "Neo-Soul",
        Chords = new List<string>
        {
          "CM7",
          "C#m7",
          "DM7",
          "D#m7",
          "EM7",
          "Fm7",
          "F#M7",
          "Gm7",
          "AbM7",
          "Am7",
          "BbM7",
          "Bm7"
        }
      },
      new()
      {
        Number = 78,
        Name = "Neo-Soul",
        Chords = new List<string>
        {
          "C11sus",
          "A7/C#",
          "Dm7",
          "EbM7",
          "C7/E",
          "F6",
          "D7/F#",
          "Gdim7",
          "E7/G#",
          "F6/A",
          "Bb6",
          "Bm7b5"
        }
      },
      new()
      {
        Number = 79,
        Name = "Neo-Soul",
        Chords = new List<string>
        {
          "Ab/C",
          "Db",
          "Bb/D",
          "Ebm",
          "C/E",
          "Db/F",
          "Gb",
          "Eb/G",
          "Db/Ab",
          "F7/A",
          "Ebm/Bb",
          "B"
        }
      },
      new()
      {
        Number = 80,
        Name = "Neo-Soul",
        Chords = new List<string>
        {
          "Cm7b5",
          "Db7sus",
          "Bbadd2/D",
          "Ebm7",
          "EM7",
          "Fmb6",
          "GbM9",
          "Ebadd9/G",
          "Ab7sus",
          "AdimM7",
          "Bbm9",
          "Gb/B"
        }
      },
      new()
      {
        Number = 81,
        Name = "Neo-Soul",
        Chords = new List<string>
        {
          "C7alt",
          "DbM7add6",
          "Bb7/D",
          "Db/Eb",
          "Edim7",
          "Fm9",
          "Gb6/9",
          "Gm7b5",
          "Eb/Ab",
          "F7/A",
          "Bbm9",
          "BM7#11"
        }
      },
      new()
      {
        Number = 82,
        Name = "Jazz/Bossa",
        Chords = new List<string>
        {
          "Gm7",
          "Bb/Ab",
          "Am7",
          "C/Bb",
          "Bm7",
          "D/C",
          "C#m7",
          "E/D",
          "D#m7",
          "F#/E",
          "Fm7",
          "Ab/Gb"
        }
      },
      new()
      {
        Number = 83,
        Name = "Bossa Nova",
        Chords = new List<string>
        {
          "CM9",
          "C#dim",
          "Dm7",
          "D#dim",
          "CM9/E",
          "FM9",
          "F#dim",
          "Gm9",
          "C13b9",
          "F6",
          "BbM9",
          "G13b9"
        }
      },
      new()
      {
        Number = 84,
        Name = "Bossa Nova",
        Chords = new List<string>
        {
          "CM7",
          "C#Dim",
          "Dm11",
          "D#Dim",
          "Em11",
          "G/F",
          "F9#11",
          "Gsus13",
          "Abdim7",
          "FM7/A",
          "Bb13",
          "Eb/B"
        }
      },
      new()
      {
        Number = 85,
        Name = "Jazz",
        Chords = new List<string>
        {
          "CM7#11",
          "DbM7#11",
          "Dm9",
          "EbM7#11",
          "Em9",
          "FM7#11",
          "F#m11",
          "G6/9",
          "AbM7#11",
          "Am9",
          "BbM13",
          "Bm11b5"
        }
      },
      new()
      {
        Number = 86,
        Name = "Jazz",
        Chords = new List<string>
        {
          "CM9",
          "Db9#11",
          "Dm9",
          "D13b9/Eb",
          "Em11",
          "FM13",
          "E/F",
          "FM7/G",
          "Ab7#9#5",
          "Am9/11",
          "BbM9",
          "Bdim7"
        }
      },
      new()
      {
        Number = 87,
        Name = "Jazz",
        Chords = new List<string>
        {
          "Cmaj7",
          "Aadd9/C#",
          "Dm6",
          "B7/D#",
          "Em7",
          "Fmaj9",
          "Dadd9/F#",
          "Gm7/9",
          "Abmaj9",
          "Cadd9/G",
          "Eadd9/G#",
          "Asus7"
        }
      },
      new()
      {
        Number = 88,
        Name = "Jazz",
        Chords = new List<string>
        {
          "Fmaj7/9",
          "Gm7b5",
          "Abmaj7/9",
          "Bbm7b5",
          "Bmaj7/9",
          "C#m7b5",
          "DM7/9",
          "Em7b5",
          "CM7/9",
          "Dm7b5/9",
          "GbM7/9",
          "Abm7b5"
        }
      },
      new()
      {
        Number = 89,
        Name = "Jazz",
        Chords = new List<string>
        {
          "Cadd9",
          "C#dim7",
          "Gadd13/B",
          "D#dim#5",
          "FM7/E",
          "G7sus2/F",
          "D#dim7",
          "C6",
          "Ddim7",
          "Am/C",
          "Dm7b5",
          "G7/D"
        }
      },
      new()
      {
        Number = 90,
        Name = "Jazz",
        Chords = new List<string>
        {
          "Em7",
          "Edim7",
          "FM7",
          "F#dim7",
          "Em7",
          "C6/E",
          "F#dim7",
          "FM7b5",
          "Eb7/F",
          "Gadd9",
          "A#11/F",
          "F#dim7"
        }
      },
      new()
      {
        Number = 91,
        Name = "Jazz",
        Chords = new List<string>
        {
          "Gm7",
          "G#M7",
          "Am7",
          "A#M7",
          "G/B",
          "D#M7",
          "A#/D",
          "D",
          "CM7sus2",
          "Em7",
          "F6",
          "C6sus2b5"
        }
      },
      new()
      {
        Number = 92,
        Name = "Jazz",
        Chords = new List<string>
        {
          "A#M7",
          "BM7",
          "Cm7b5",
          "C#dim7",
          "Em7b5/D",
          "Fm7/D#",
          "Edim7",
          "F7/D#",
          "F#dim7",
          "Gm7/F",
          "G#M7/D#",
          "F7/D#"
        }
      },
      new()
      {
        Number = 93,
        Name = "Jazz",
        Chords = new List<string>
        {
          "A#M7/A",
          "G#6",
          "Am7",
          "A#M7",
          "Gadd11/B",
          "FM7/C",
          "A7/C",
          "D7/C",
          "D#M7b5/D",
          "Cadd9/D",
          "Fadd9",
          "Cdim7"
        }
      },
      new()
      {
        Number = 94,
        Name = "Jazz",
        Chords = new List<string>
        {
          "CM7",
          "DbM7",
          "Dm7",
          "Ebm7add13",
          "Em7b13",
          "Fm7",
          "F#m7b5",
          "G9sus",
          "G#dim7",
          "Am6",
          "F/Bb",
          "Bdim7"
        }
      },
      new()
      {
        Number = 95,
        Name = "Classical",
        Chords = new List<string>
        {
          "FM7/E",
          "Bdim/D",
          "Am",
          "G#dim7",
          "C/G",
          "Amb9/C",
          "Fadd9/C",
          "Dm",
          "C/G",
          "C/G",
          "Fadd9/G",
          "Ddim/G"
        }
      },
      new()
      {
        Number = 96,
        Name = "Classical",
        Chords = new List<string>
        {
          "Am",
          "Bm7/A",
          "Fdim/B",
          "C/E",
          "A7/G",
          "Dm7",
          "D#aug",
          "E",
          "F",
          "D/F#",
          "C/G",
          "E/G#"
        }
      },
      new()
      {
        Number = 97,
        Name = "Classical",
        Chords = new List<string>
        {
          "F#/C#",
          "F#/A#",
          "G#m7",
          "A6",
          "F#/C#",
          "Bsus2",
          "G#/C",
          "C#7",
          "A#7/D",
          "F#6sus4/C#",
          "C#m7",
          "C#7"
        }
      },
      new()
      {
        Number = 98,
        Name = "Classical",
        Chords = new List<string>
        {
          "Dm",
          "D#M7/D",
          "E7/D",
          "Dm7",
          "D7",
          "Gm/D",
          "G#/D",
          "A/D",
          "A#add9/D",
          "DM7(13)",
          "Csus2/D",
          "G#dim/D"
        }
      },
      new()
      {
        Number = 99,
        Name = "Modern",
        Chords = new List<string>
        {
          "CM13",
          "AM9/C#",
          "Dm13",
          "EbM13",
          "CM9/E",
          "FM13",
          "FmM13",
          "CM9(no 3)/G",
          "AbMb5#9",
          "Am11",
          "BbM9",
          "G6/9"
        }
      },
      new()
      {
        Number = 100,
        Name = "Modern",
        Chords = new List<string>
        {
          "CM9",
          "Cm9",
          "Dm9",
          "Dm6/9",
          "CM9/E",
          "Dm9/F",
          "D9/F#",
          "Gsus13",
          "G13b9",
          "Abmaj13",
          "AbDimM7",
          "BbM13"
        }
      }
    ];
  </script>

  <script>
    const noteOrder = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    const flatToSharp = { Db: "C#", Eb: "D#", Gb: "F#", Ab: "G#", Bb: "A#" };

    const searchBox = document.getElementById("search");
    const clearBtn = document.getElementById("clear");
    const resultsHost = document.getElementById("results");
    const resultSummary = document.getElementById("resultSummary");
    const browserHost = document.getElementById("browser");

    const rawData = document.getElementById("chord-data").textContent;
    const chordSets = parseChordSets(rawData).map((set, index) => ({ id: index, ...set }));
    const browserState = new Map(chordSets.map(set => [set.id, 0]));

    function parseChordSets(raw) {
      let text = raw.trim();
      text = text.replace(/^return\s+/i, "");
      text = text.replace(/;?\s*$/g, "");
      text = text.replace(/Chords\s*=\s*new List<string>\s*{([\s\S]*?)}/g, "Chords = [$1]");
      text = text.replace(/new\(\)\s*{/g, "{");
      text = text.replace(/Number\s*=/g, '"number":');
      text = text.replace(/Name\s*=/g, '"name":');
      text = text.replace(/Chords\s*=/g, '"chords":');
      text = text.replace(/=/g, ":");
      text = text.replace(/,\s*]/g, "]");
      text = text.replace(/,\s*}/g, "}");
      const jsonReady = text.replace(/([[{,]\s*)([A-Za-z0-9_]+)\s*:/g, '$1"$2":');
      return JSON.parse(jsonReady);
    }

    function normalizeNote(note) {
      return flatToSharp[note] || note;
    }

    function transposeNote(note, semitones) {
      const normalized = normalizeNote(note);
      const idx = noteOrder.indexOf(normalized);
      if (idx === -1) return note;
      let next = (idx + semitones) % 12;
      if (next < 0) next += 12;
      return noteOrder[next];
    }

    function extractNote(token) {
      if (!token) return "";
      if (token.length >= 2 && (token[1] === "#" || token[1] === "b")) {
        return token.slice(0, 2);
      }
      return token[0];
    }

    function transposeChord(chord, semitones) {
      const [base, slash] = chord.split("/");
      const root = extractNote(base);
      const suffix = base.slice(root.length);
      const newRoot = transposeNote(root, semitones) + suffix;

      if (!slash) return newRoot;
      const bassRoot = extractNote(slash);
      const bassSuffix = slash.slice(bassRoot.length);
      const newBass = transposeNote(bassRoot, semitones) + bassSuffix;
      return `${newRoot}/${newBass}`;
    }

    function globToRegex(glob) {
      const escaped = glob.replace(/[.+^${}()|[\]\\]/g, "\\$&");
      const regex = "^" + escaped.replace(/\*/g, ".*").replace(/\?/g, ".") + "$";
      return new RegExp(regex, "i");
    }

    function isMatch(chord, glob) {
      return globToRegex(glob).test(chord);
    }

    function search() {
      const terms = searchBox.value
        .split(/[\s,]+/)
        .map(t => t.trim())
        .filter(Boolean);

      const results = [];
      if (terms.length === 0) {
        renderResults(results);
        return;
      }

      for (const set of chordSets) {
        for (let k = 0; k < 12; k++) {
          const transposed = set.chords.map(ch => transposeChord(ch, k));
          const ok = terms.every(term => transposed.some(ch => isMatch(ch, term)));
          if (ok) {
            results.push({ ...set, transposition: k, transposed });
          }
        }
      }

      renderResults(results);
    }

    function renderResults(results) {
      if (results.length === 0) {
        resultsHost.innerHTML = `<p class="empty">No matches yet. Type chords above to search (supports * and ? globs).</p>`;
        resultSummary.textContent = "";
        return;
      }

      resultSummary.textContent = `${results.length} progression${results.length === 1 ? "" : "s"}`;
      resultsHost.innerHTML = results.map(r => cardHtml(r, r.transposed, r.transposition, false)).join("");
    }

    function renderBrowser() {
      const cards = chordSets.map(set => {
        const k = browserState.get(set.id) ?? 0;
        const transposed = set.chords.map(ch => transposeChord(ch, k));
        return cardHtml(set, transposed, k, true);
      });
      browserHost.innerHTML = cards.join("");
    }

    function cardHtml(set, chords, transposition, includeTransposer) {
      const header = `<div class="card-header">
          <div><strong>${set.number}</strong> • ${set.name}</div>
          <span class="badge">+${transposition} st</span>
        </div>`;

      const slider = includeTransposer
        ? `<div>
            <input class="transposer" type="range" min="0" max="11" value="${transposition}" data-id="${set.id}" />
            <div class="summary">Drag to transpose this row</div>
          </div>`
        : "";

      // Piano key layout:
      // White keys (indices): C=0, D=2, E=4, F=5, G=7, A=9, B=11
      // Black keys (indices): C#=1, D#=3, F#=6, G#=8, A#=10
      const whiteKeyIndices = [0, 2, 4, 5, 7, 9, 11];
      const blackKeyIndices = [1, 3, null, 6, 8, 10, null]; // null = no black key in that slot

      const whiteKeys = whiteKeyIndices.map(i => 
        `<div class="white-key" data-chord-index="${i}"><span class="chord-label">${chords[i]}</span></div>`
      ).join("");

      const blackKeys = blackKeyIndices.map(i => 
        i !== null 
          ? `<div class="black-key-slot"><div class="black-key" data-chord-index="${i}"><span class="chord-label">${chords[i]}</span></div></div>`
          : `<div class="black-key-slot"><div class="black-key"></div></div>`
      ).join("");

      const keyboard = `<div class="keyboard" data-keyboard-id="${set.id}" data-set-number="${set.number}" data-transposition="${transposition}">
        <div class="white-keys">${whiteKeys}</div>
        <div class="black-keys">${blackKeys}</div>
      </div>`;

      return `<div class="card" data-card-id="${set.id}">
        ${header}
        ${slider}
        ${keyboard}
      </div>`;
    }

    function updateKeyboard(id, chords) {
      const keyboard = browserHost.querySelector(`[data-keyboard-id="${id}"]`);
      const badge = browserHost.querySelector(`[data-card-id="${id}"] .badge`);
      if (!keyboard) return;

      const whiteKeyIndices = [0, 2, 4, 5, 7, 9, 11];
      const blackKeyIndices = [1, 3, null, 6, 8, 10, null];

      const whiteKeys = whiteKeyIndices.map(i => 
        `<div class="white-key" data-chord-index="${i}"><span class="chord-label">${chords[i]}</span></div>`
      ).join("");

      const blackKeys = blackKeyIndices.map(i => 
        i !== null 
          ? `<div class="black-key-slot"><div class="black-key" data-chord-index="${i}"><span class="chord-label">${chords[i]}</span></div></div>`
          : `<div class="black-key-slot"><div class="black-key"></div></div>`
      ).join("");

      keyboard.innerHTML = `<div class="white-keys">${whiteKeys}</div><div class="black-keys">${blackKeys}</div>`;

      const k = browserState.get(id) ?? 0;
      keyboard.dataset.transposition = k;
      if (badge) badge.textContent = `+${k} st`;
    }

    browserHost.addEventListener("input", evt => {
      const target = evt.target;
      if (target.classList.contains("transposer")) {
        const id = Number(target.dataset.id);
        const value = Number(target.value);
        browserState.set(id, value);
        const set = chordSets.find(s => s.id === id);
        if (set) {
          const transposed = set.chords.map(ch => transposeChord(ch, value));
          updateKeyboard(id, transposed);
        }
      }
    });

    searchBox.addEventListener("input", search);
    clearBtn.addEventListener("click", () => {
      searchBox.value = "";
      search();
    });

    renderBrowser();
    search();

    /* ── Chord Playback ───────────────────────────────────────────── */

    /* Exact MIDI notes from the Roland J-6 manual, indexed by set number then chord position (0-11). */
    const _exactNotes = {
      1: [[64,62,55,48],[65,63,60,49],[60,57,65,50],[67,62,58,51],[67,62,60,52],[67,64,57,41],[64,62,57,42],[67,64,62,43],[65,62,60,44],[65,60,57,45],[67,62,58,46],[67,62,59,47]],
      2: [[62,59,52,48],[64,58,55,49],[64,60,53,50],[66,60,57,51],[67,62,59,52],[67,64,57,53],[65,60,57,54],[65,60,57,43],[67,60,59,44],[64,60,55,46],[65,62,57,47],[67,64,59,52]],
      3: [[62,57,52,48],[64,59,53,49],[64,60,53,50],[66,61,55,51],[67,62,56,52],[67,64,57,53],[69,64,58,54],[64,59,53,43],[65,60,54,44],[62,60,55,45],[62,60,56,46],[64,62,57,47]],
      4: [[62,57,52,48],[63,59,53,49],[64,60,53,50],[65,61,55,51],[66,62,55,52],[67,63,56,41],[64,60,57,42],[63,59,53,43],[65,60,54,44],[65,61,55,45],[67,62,56,46],[64,62,57,47]],
      5: [[62,59,52,48],[63,60,53,49],[64,61,54,50],[65,62,55,51],[66,63,56,52],[67,64,57,53],[68,65,58,54],[69,66,59,55],[70,67,60,56],[71,68,61,57],[72,69,62,58],[73,70,63,59]],
      6: [[64,62,58,48],[63,59,53,49],[64,60,54,50],[65,61,55,51],[67,63,57,52],[63,60,57,41],[64,59,53,42],[65,62,59,43],[65,61,55,44],[67,62,58,45],[65,62,57,46],[65,61,55,47]],
      7: [[72,67,64,48],[70,67,64,49],[69,65,62,50],[71,67,64,51],[72,69,65,52],[72,69,65,53],[72,69,64,54],[71,67,62,55],[71,65,62,56],[72,69,64,45],[70,65,62,46],[71,65,62,47]],
      8: [[72,67,63,48],[68,65,61,49],[68,65,62,50],[70,67,63,51],[70,67,61,52],[68,65,60,41],[69,63,60,42],[67,62,58,43],[68,63,60,44],[67,63,60,45],[70,65,62,46],[68,65,62,47]],
      9: [[72,67,63,48],[68,65,61,49],[68,65,62,50],[71,67,63,51],[67,64,52],[68,65,60,41],[69,63,60,42],[67,62,59,43],[60,63,68,44],[67,63,60,45],[70,65,62,46],[71,65,62,47]],
      10: [[67,63,62,48],[65,60,56,49],[68,65,60,50],[67,62,58,51],[67,61,58,52],[67,63,56,41],[63,60,57,42],[65,62,58,43],[67,63,60,44],[67,63,60,45],[63,60,56,46],[65,62,56,47]],
      11: [[67,63,62,48],[67,63,58,49],[65,60,56,50],[67,62,58,51],[66,63,56,52],[67,63,56,41],[63,60,57,42],[67,62,58,43],[67,63,60,44],[67,63,60,45],[67,63,60,46],[67,63,62,47]],
      12: [[65,63,58,48],[64,59,53,49],[68,65,60,50],[67,62,59,51],[66,62,56,40],[67,63,57,41],[63,60,57,42],[70,65,59,43],[67,63,60,44],[67,63,60,45],[65,61,56,46],[65,62,56,47]],
      13: [[62,58,51,48],[63,59,53,49],[64,60,53,50],[65,61,55,51],[66,63,56,40],[67,63,57,41],[63,60,57,42],[64,59,53,43],[65,63,56,44],[65,60,57,45],[65,62,58,46],[64,62,57,47]],
      17: [[55,52,48],[56,53,49],[57,54,50],[58,55,51],[59,56,52],[60,57,53],[61,58,54],[62,59,55],[63,60,56],[64,61,57],[65,62,58],[67,63,59]],
      18: [[55,51,48],[56,52,49],[57,53,50],[58,54,51],[59,56,52],[60,56,53],[61,57,54],[62,58,55],[63,59,56],[64,60,57],[65,61,58],[67,62,59]],
      19: [[59,55,52,48],[60,56,53,49],[61,57,54,50],[62,58,55,51],[63,59,56,52],[64,60,57,53],[65,61,58,54],[66,62,59,55],[67,63,60,56],[68,64,61,57],[69,65,62,58],[70,66,63,59]],
      20: [[58,55,51,48],[59,56,52,49],[60,57,53,50],[61,58,54,51],[62,59,55,52],[63,60,56,53],[64,61,57,54],[65,62,58,55],[66,63,59,56],[67,64,60,57],[68,65,61,58],[69,66,62,59]],
      21: [[62,59,52,48],[63,60,53,49],[64,61,54,50],[65,62,55,51],[66,63,56,52],[67,64,57,53],[68,66,58,54],[69,66,59,55],[70,68,60,56],[71,68,61,57],[72,70,62,58],[73,70,63,59]],
      22: [[62,58,51,48],[63,59,52,49],[64,60,53,50],[65,61,54,51],[66,63,55,52],[67,63,57,53],[66,63,57,54],[67,63,56,43],[68,64,57,56],[69,65,58,57],[70,66,59,58],[71,67,60,59]],
      23: [[66,62,59,48],[67,63,60,49],[68,64,61,50],[69,65,62,51],[70,66,63,52],[71,67,64,53],[72,68,65,54],[73,69,66,55],[74,70,67,56],[75,71,68,57],[76,72,69,58],[77,73,70,59]],
      24: [[65,62,58,48],[66,63,59,49],[67,64,60,50],[68,65,61,51],[69,66,62,52],[70,67,63,53],[71,68,64,54],[72,69,65,55],[73,70,66,56],[74,71,67,57],[75,72,68,58],[76,73,69,59]],
      25: [[59,55,52,48],[60,59,55,52],[64,60,59,55],[67,64,60,59],[71,67,64,60],[72,71,67,64],[76,72,71,67],[79,76,72,71],[83,79,76,72],[84,83,79,76],[88,84,83,79],[91,88,84,83]],
      26: [[58,55,51,48],[60,58,55,51],[63,60,58,55],[67,63,60,58],[70,67,63,60],[72,70,67,63],[75,72,70,67],[79,75,72,70],[82,79,75,72],[84,82,79,75],[87,84,82,79],[91,87,84,82]],
      27: [[64,55,48],[67,59,52],[71,62,55],[72,64,57],[74,66,59],[76,67,60],[79,71,64],[83,74,67],[84,76,69],[86,78,71],[88,79,72],[91,83,76]],
      28: [[60,55,52,48],[58,55,52,48],[60,57,53,50],[60,55,50,39],[60,55,52,40],[60,57,53,41],[60,56,53,41],[59,55,50,43],[60,55,52,43],[60,55,52,45],[60,56,52,46],[59,55,53,47]],
      29: [[72,65,64,48],[65,62,58,48],[65,60,57,50],[66,60,57,50],[64,58,55,48],[65,60,57,53],[65,63,57,53],[67,62,58,55],[69,64,60,55],[69,65,60,57],[70,65,60,58],[71,67,62,59]],
      30: [[63,55,48],[67,58,51],[68,60,44],[70,62,46],[67,62,55],[68,63,56],[63,58,51],[62,58,51],[60,55,48],[62,59,55],[68,63,60],[65,60,57]],
      31: [[72,65,64,48],[65,62,58,48],[65,60,57,50],[66,60,57,50],[64,58,55,48],[65,60,57,53],[65,63,57,53],[67,62,58,55],[69,64,60,55],[69,65,60,57],[70,65,60,58],[71,67,62,59]],
      32: [[63,56,55,48],[67,62,58,51],[65,59,55,50],[65,62,58,51],[64,58,55,48],[68,63,58,53],[63,58,55,51],[67,62,58,55],[68,63,60,56],[67,63,58,56],[69,65,62,57],[70,63,60,58]],
      33: [[59,55,52,48],[60,57,53,52],[62,57,53,46],[62,59,55,43],[65,60,57,50],[64,60,55,48],[65,60,57,46],[67,62,59,43],[64,60,55,48],[64,61,57,49],[65,62,57,50],[67,62,59,53]],
      34: [[62,55,50,48],[64,57,52,50],[65,58,53,51],[67,60,55,53],[69,62,57,55],[72,65,60,58],[74,67,62,60],[76,69,64,62],[77,70,65,63],[79,72,67,65],[81,74,69,67],[84,77,72,70]],
      35: [[71,64,55,48],[67,60,52,45],[73,66,57,50],[69,62,54,47],[75,68,59,52],[71,64,56,49],[73,66,58,54],[70,63,54,51],[75,68,60,56],[70,63,56,53],[73,65,58,58],[69,62,55,55]],
      36: [[63,58,53,48],[65,60,55,50],[67,62,57,52],[68,63,58,53],[70,65,60,55],[72,67,62,57],[74,69,64,59],[75,70,65,60],[77,72,67,62],[79,74,69,64],[80,75,70,65],[82,77,72,67]],
      37: [[64,60,55,48],[67,62,60,55],[67,62,60,55],[65,62,58,51],[64,60,55,52],[67,62,60,53],[62,57,54,54],[64,60,55,43],[64,60,56,44],[64,60,57,45],[65,60,58,53],[67,62,59,47]],
      38: [[69,62,55,48],[69,64,57,50],[69,67,59,52],[69,64,62,50],[71,58,55,51],[69,64,57,55],[69,64,60,55],[69,64,60,55],[70,65,62,58],[67,62,58,57],[70,65,60,58],[70,65,61,58]],
      39: [[57,55,53,48],[58,57,55,50],[58,57,55,52],[60,55,53,50],[62,58,57,53],[62,58,57,55],[64,60,57,55],[64,60,57,55],[65,60,57,58],[67,62,58,57],[70,65,60,58],[61,58,65,58]],
      40: [[55,52,50,48],[57,54,52,50],[58,55,53,51],[60,57,55,53],[62,59,57,55],[63,60,58,56],[65,62,60,58],[67,64,62,60],[69,66,64,62],[70,67,65,63],[72,69,67,65],[74,71,69,67]],
      41: [[60,55,52,36],[58,55,52,37],[60,55,53,38],[60,55,50,39],[60,57,52,40],[60,57,53,41],[60,57,54,42],[60,55,50,43],[60,56,53,44],[60,55,52,45],[60,55,50,46],[59,55,53,47]],
      42: [[72,64,55,48],[72,65,58,51],[70,65,56,44],[71,62,55,47],[72,64,55,48],[72,65,56,41],[72,63,57,42],[72,64,55,43],[72,63,56,44],[72,65,57,45],[70,65,62,46],[71,67,53,47]],
      43: [[67,63,58,48],[65,62,58,48],[67,63,58,44],[65,62,58,44],[63,60,58,53],[62,58,53,53],[67,63,58,44],[62,58,53,46],[63,60,58,44],[65,60,57,45],[63,60,58,46],[65,63,56,47]],
      44: [[79,70,67,63,48],[68,63,61,53],[67,62,58,55],[70,63,55,51],[67,62,60,52],[68,63,60,53],[69,63,60,54],[68,63,60,55],[67,63,60,48],[70,65,62,58],[68,63,60,53],[67,62,59,55]],
      45: [[56,51,48],[56,53,48],[58,55,50],[60,56,51],[60,56,53],[62,58,53],[62,58,55],[63,60,55],[63,60,56],[65,60,56],[65,62,58],[67,63,60]],
    };

    /* Interval-based fallback for sets without exact data */
    const _noteVal = { C:0,'C#':1,Db:1,D:2,'D#':3,Eb:3,E:4,F:5,'F#':6,Gb:6,G:7,'G#':8,Ab:8,A:9,'A#':10,Bb:10,B:11 };

    const _qualityIntervals = {
      '':       [0,4,7],
      'M':      [0,4,7],
      'maj':    [0,4,7],
      'm':      [0,3,7],
      'min':    [0,3,7],
      'dim':    [0,3,6],
      'Dim':    [0,3,6],
      'aug':    [0,4,8],
      'sus2':   [0,2,7],
      'sus4':   [0,5,7],
      'sus':    [0,5,7],
      '5':      [0,7],

      '6':       [0,4,7,9],
      'm6':      [0,3,7,9],
      '6/9':     [0,4,7,9,14],
      'M6/9':    [0,4,7,9,14],
      'm6/9':    [0,3,7,9,14],
      '6sus2':   [0,2,7,9],
      '6sus4':   [0,5,7,9],
      '6sus2b5': [0,2,6,9],

      '7':       [0,4,7,10],
      'M7':      [0,4,7,11],
      'maj7':    [0,4,7,11],
      'm7':      [0,3,7,10],
      'dim7':    [0,3,6,9],
      'm7b5':    [0,3,6,10],
      'aug7':    [0,4,8,10],
      'M7#5':    [0,4,8,11],
      '7sus4':   [0,5,7,10],
      '7sus2':   [0,2,7,10],
      '7sus':    [0,5,7,10],
      'sus7':    [0,5,7,10],
      'dimM7':   [0,3,6,11],
      'DimM7':   [0,3,6,11],
      '7#5':     [0,4,8,10],
      '7#9':     [0,4,7,10,15],
      '7#9#5':   [0,4,8,10,15],
      '7(13)':   [0,4,7,10,21],
      '7add9':   [0,4,7,10,14],
      '7alt':    [0,4,6,10,13],
      '7b13':    [0,4,7,10,20],
      '7b9':     [0,4,7,10,13],
      'M7#11':   [0,4,7,11,18],
      'M7(13)':  [0,4,7,11,21],
      'M7add6':  [0,4,7,9,11],
      'M7b5':    [0,4,6,11],
      'M7sus2':  [0,2,7,11],
      'M7/9':    [0,4,7,11,14],
      'maj7/9':  [0,4,7,11,14],

      '9':       [0,4,7,10,14],
      'M9':      [0,4,7,11,14],
      'maj9':    [0,4,7,11,14],
      'm9':      [0,3,7,10,14],
      'add9':    [0,4,7,14],
      'madd9':   [0,3,7,14],
      'mAdd9':   [0,3,7,14],
      'add2':    [0,2,4,7],
      'Madd2':   [0,2,4,7],
      'Madd4':   [0,4,5,7],
      '9#11':    [0,4,7,10,14,18],
      '9sus':    [0,5,7,10,14],
      'sus9':    [0,5,7,10,14],
      'M9#11':   [0,4,7,11,14,18],
      'M9(no 3)':[0,7,11,14],
      'm9/11':   [0,3,7,10,14,17],
      'm7/9':    [0,3,7,10,14],
      'm7b5/9':  [0,3,6,10,14],

      '11':      [0,4,7,10,14,17],
      'm11':     [0,3,7,10,14,17],
      'add11':   [0,4,7,17],
      'madd11':  [0,3,7,17],
      '11sus':   [0,5,7,10,17],
      '11sus2':  [0,2,7,10,17],
      'sus11':   [0,5,7,10,17],
      'm11b5':   [0,3,6,10,14,17],
      'm7(11)':  [0,3,7,10,17],
      'm7/11':   [0,3,7,10,17],
      'dim11':   [0,3,6,9,17],

      '13':      [0,4,7,10,14,21],
      'M13':     [0,4,7,11,14,21],
      'maj13':   [0,4,7,11,14,21],
      'm13':     [0,3,7,10,14,21],
      'mM13':    [0,3,7,11,14,21],
      'M13(no 3)':[0,7,11,14,21],
      '13b9':    [0,4,7,10,13,21],
      'add13':   [0,4,7,9],
      'sus13':   [0,5,7,10,21],
      'sus9/13': [0,5,7,10,14,21],
      'm7add13': [0,3,7,10,21],
      'm7b13':   [0,3,7,10,20],

      'aug#9':   [0,4,8,10,15],
      'addb9':   [0,4,7,13],
      'mb9':     [0,3,7,13],
      'mb6':     [0,3,7,8],
      'mb13':    [0,3,7,20],
      'Mb7':     [0,4,7,10],
      'Mb5#9':   [0,4,6,15],
      '5b9':     [0,7,13],
      '5add9b13':[0,7,14,20],
      'sus4b9':  [0,5,7,13],
      'dim#5':   [0,3,8],
      'm6addb13':[0,3,7,9,20],
      'm7add6':  [0,3,7,9,10],
    };

    function _extractNoteName(s) {
      if (!s) return null;
      if (s.length >= 2 && (s[1] === '#' || s[1] === 'b')) return s.slice(0,2);
      if (s[0] >= 'A' && s[0] <= 'G') return s.slice(0,1);
      return null;
    }

    function _noteToMidi(noteName) {
      const n = normalizeNote(noteName);
      return _noteVal[n] ?? null;
    }

    function _parseChordNotes(chordName) {
      if (!chordName) return null;

      /* separate slash‑chord bass */
      let main = chordName, bassName = null;
      const si = chordName.lastIndexOf('/');
      if (si > 0) {
        const afterSlash = chordName.slice(si + 1);
        const bn = _extractNoteName(afterSlash);
        if (bn && bn.length === afterSlash.length && _noteToMidi(bn) !== null) {
          bassName = bn;
          main = chordName.slice(0, si);
        }
      }

      /* root */
      const root = extractNote(main);
      if (!root) return null;
      const rootVal = _noteToMidi(root);
      if (rootVal === null) return null;

      const quality = main.slice(root.length);
      let intervals = _qualityIntervals[quality];
      if (!intervals) intervals = [0,4,7]; /* fallback: major triad */

      /* build MIDI notes – root at C3 (48) */
      const base = 48 + rootVal;
      let notes = intervals.map(i => base + i);

      /* bass note for slash chords */
      if (bassName) {
        const bv = _noteToMidi(bassName);
        if (bv !== null) {
          let bm = 36 + bv;           /* start at C2 */
          while (bm >= notes[0]) bm -= 12;
          if (bm < 36) bm += 12;
          /* remove duplicate from chord body if present */
          notes = notes.filter(n => n % 12 !== bm % 12);
          notes = [bm, ...notes];
        }
      }

      return notes;
    }

    function _getNotesForKey(key) {
      const keyboard = key.closest('.keyboard');
      if (!keyboard) return null;

      const chordIndex = parseInt(key.dataset.chordIndex, 10);
      if (isNaN(chordIndex)) return null;

      const setNumber = parseInt(keyboard.dataset.setNumber, 10);
      const transposition = parseInt(keyboard.dataset.transposition, 10) || 0;

      /* Use exact notes from the J-6 manual when available */
      const setNotes = _exactNotes[setNumber];
      if (setNotes && setNotes[chordIndex]) {
        return setNotes[chordIndex].map(n => n + transposition);
      }

      /* Fallback: parse chord name using interval table */
      const label = key.querySelector('.chord-label');
      if (!label || !label.textContent.trim()) return null;
      return _parseChordNotes(label.textContent.trim());
    }

    /* ── Web Audio playback ──────────────────────────────────────── */
    let _audioCtx = null;
    function _ctx() {
      if (!_audioCtx) _audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (_audioCtx.state === 'suspended') _audioCtx.resume();
      return _audioCtx;
    }

    function _midiToFreq(m) { return 440 * Math.pow(2, (m - 69) / 12); }

    function _playNotes(midiNotes, dur) {
      dur = dur || 1.2;
      const ctx = _ctx();
      const now = ctx.currentTime;
      const vol = 0.22 / Math.sqrt(midiNotes.length);
      midiNotes.forEach(m => {
        const osc = ctx.createOscillator();
        const g   = ctx.createGain();
        osc.type = 'triangle';
        osc.frequency.value = _midiToFreq(m);
        g.gain.setValueAtTime(0, now);
        g.gain.linearRampToValueAtTime(vol, now + 0.03);
        g.gain.setValueAtTime(vol, now + dur * 0.6);
        g.gain.exponentialRampToValueAtTime(0.001, now + dur);
        osc.connect(g).connect(ctx.destination);
        osc.start(now);
        osc.stop(now + dur);
      });
    }

    /* ── Click handling (event delegation) ───────────────────────── */
    function _handleKeyClick(e) {
      const key = e.target.closest('.white-key, .black-key');
      if (!key) return;

      const notes = _getNotesForKey(key);
      if (notes && notes.length) _playNotes(notes);

      /* visual feedback */
      key.classList.add('active');
      setTimeout(() => key.classList.remove('active'), 300);
    }

    document.addEventListener('click', _handleKeyClick);
  </script>
</body>
</html>
